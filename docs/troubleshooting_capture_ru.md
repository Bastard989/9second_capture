# 9second_capture: Диагностика проблем захвата

## 1) Системный звук 0-2% (YouTube слышно, но в агенте почти ноль)

Симптомы:
- В блоке записи `System: 1%` или близко к нулю.
- `Сигнал: ожидание` или `слабый`.
- Микрофон может показывать уровень, а системный трек почти пустой.

Причина:
- Звук встречи/YouTube не направлен в виртуальный драйвер (`BlackHole`/`VB-CABLE`/`Monitor`).
- Или уровень вывода системы слишком низкий.

Что сделать:
1. macOS: в `Audio MIDI Setup` создайте `Multi-Output Device` (колонки + BlackHole).
2. Сделайте `Multi-Output Device` системным выходом на время теста.
3. В агенте в режиме `Драйвер: системный звук` выберите именно виртуальный вход BlackHole.
4. Запустите YouTube и проверьте, что `System` стабильно выше 5-10%.
5. Если `System` низкий, но `Mic` высокий: это почти всегда неправильный роутинг.

## 2) Ошибка “Запись уже запущена в другом окне/вкладке”

Симптомы:
- Старт блокируется, показывается ошибка про другое окно.

Причина:
- Осталась активная незавершенная сессия записи.
- Или lock захвата в браузере не успел очиститься.

Что сделать:
1. Нажать кнопку `Забрать управление в этом окне`.
2. Дождаться сообщения об успешном перехвате.
3. Запустить запись повторно.

## 3) Переименование записи “не применилось”

Симптомы:
- Нажали `Переименовать запись`, но в списке осталось старое имя.

Причина:
- Ошибка ответа API при rename.
- Или обновление списка пришло с задержкой.

Что сделать:
1. Нажать `Переименовать запись` снова.
2. Если не помогло, открыть лог API и найти событие `meeting_renamed` или `meeting_rename_invalid`.
3. Проверить, что имя не пустое.

## 4) Время записи “не то”

Симптом:
- Дата/время в списке отличаются от ожидаемого локального времени.

Текущее правило:
- В UI время отображается в часовом поясе `Europe/Moscow (MSK)`.

## 5) Как тестировать в одиночку (рекомендуемый чеклист)

1. До старта:
- Включить YouTube на 30-60 сек.
- Проверить, что выбран правильный виртуальный драйвер.

2. Запись:
- Нажать `Старт`, дать 10-15 сек проигрывания.
- Проверить `System` и `Mic` уровни в индикаторе.

3. Остановка:
- Нажать `Стоп`.
- Сохранить MP3 и открыть в любом плеере.

4. Проверка отчётов:
- Сформировать `Raw` и `Clean` TXT.
- Экспортнуть JSON/CSV.

5. Если что-то пошло не так:
- Сразу открыть логи и найти события:
  - `ui_event`
  - `meeting_start_request`
  - `ws_chunk_capture_snapshot`
  - `ws_chunk_low_system_level`
  - `meeting_finish_completed`
