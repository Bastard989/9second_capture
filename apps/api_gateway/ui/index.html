<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>9second_capture — Local Agent</title>
    <link rel="stylesheet" href="/ui/styles.css?v=20260213a" />
  </head>
  <body>
    <div class="bg-layer"></div>
    <header class="header">
      <div class="brand">
        <div class="brand-mark">9s</div>
        <div class="brand-text">
          <div class="brand-title">9second_capture</div>
          <div class="brand-subtitle" data-i18n="subtitle">
            Локальный агент записи встреч
          </div>
        </div>
      </div>
      <div class="header-actions">
        <div class="theme-toggle">
          <span class="theme-label" data-i18n="theme_label">Тема</span>
          <div class="segmented">
            <button id="themeLight" class="ghost active" data-theme="light">
              Light
            </button>
            <button id="themeDark" class="ghost" data-theme="dark">
              Dark
            </button>
          </div>
        </div>
        <div class="lang-toggle">
          <button class="lang-btn" data-lang="ru">RU</button>
          <button class="lang-btn" data-lang="en">EN</button>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="card card-connection">
        <h2 data-i18n="connection_title">Подключение</h2>
        <div class="field">
          <label for="apiKey" data-i18n="api_key_label">API ключ (опционально)</label>
          <input
            id="apiKey"
            type="password"
            autocomplete="off"
            placeholder="X-API-Key"
            data-i18n-placeholder="api_key_placeholder"
          />
        </div>
        <div class="field interview-meta">
          <label data-i18n="interview_meta_title">Контекст интервью (обязательно)</label>
          <div class="meta-grid">
            <input
              id="metaCandidateName"
              type="text"
              autocomplete="off"
              placeholder="Имя кандидата"
              data-i18n-placeholder="meta_candidate_name"
            />
            <input
              id="metaCandidateId"
              type="text"
              autocomplete="off"
              placeholder="Candidate ID"
              data-i18n-placeholder="meta_candidate_id"
            />
            <input
              id="metaVacancy"
              type="text"
              autocomplete="off"
              placeholder="Вакансия"
              data-i18n-placeholder="meta_vacancy"
            />
            <input
              id="metaLevel"
              type="text"
              autocomplete="off"
              placeholder="Уровень (Junior/Middle/Senior)"
              data-i18n-placeholder="meta_level"
            />
            <input
              id="metaInterviewer"
              type="text"
              autocomplete="off"
              placeholder="Интервьюер"
              data-i18n-placeholder="meta_interviewer"
            />
          </div>
          <div class="hint" data-i18n="interview_meta_hint">
            Эти поля обязательны для объективного сравнения кандидатов между интервью.
          </div>
        </div>
        <div class="field">
          <label for="llmModelSelect" data-i18n="llm_model_label">LLM модель</label>
          <div class="row llm-row">
            <select id="llmModelSelect"></select>
            <button id="scanLlmModels" class="ghost" data-i18n="llm_scan_btn">
              Сканировать
            </button>
            <button id="applyLlmModel" class="ghost" data-i18n="llm_apply_btn">
              Сменить модель
            </button>
          </div>
          <div id="llmStatusText" class="hint llm-status" data-i18n="llm_status_loading">
            Загружаем настройки LLM...
          </div>
        </div>
        <div class="field">
          <label for="deviceSelect" data-i18n="device_label">Источник аудио</label>
          <div class="row">
            <select id="deviceSelect"></select>
            <button id="refreshDevices" class="ghost" data-i18n="refresh_devices">
              Обновить
            </button>
          </div>
        </div>
        <div class="hint" data-i18n="device_hint">
          Выберите виртуальный драйвер захвата системного звука.
        </div>
        <div id="deviceStatusText" class="hint device-status" data-i18n="device_status_unknown">
          Устройства не проверены.
        </div>
        <div class="row">
          <button id="checkDriver" class="ghost" data-i18n="driver_check">
            Проверить драйвер
          </button>
          <button id="driverHelpBtn" class="ghost" data-i18n="driver_help_btn">
            Инструкция
          </button>
          <span id="driverStatus" class="pill muted" data-i18n="driver_unknown">
            Драйвер не проверен
          </span>
        </div>
        <div id="driverHelp" class="driver-help hidden">
          <div class="driver-tabs">
            <button class="driver-tab active" data-os="mac" data-i18n="os_mac">
              macOS
            </button>
            <button class="driver-tab" data-os="win" data-i18n="os_windows">
              Windows
            </button>
            <button class="driver-tab" data-os="linux" data-i18n="os_linux">
              Linux
            </button>
          </div>
          <div class="driver-panel" data-os="mac">
            <div data-i18n="driver_mac_1">
              Установите BlackHole (2ch) и создайте Multi‑Output Device.
            </div>
            <div data-i18n="driver_mac_2">
              Выход системы → Multi‑Output, вход агента → BlackHole.
            </div>
            <a
              class="driver-link"
              href="https://existential.audio/blackhole/"
              target="_blank"
              rel="noopener noreferrer"
            >
              BlackHole — скачать
            </a>
          </div>
          <div class="driver-panel hidden" data-os="win">
            <div data-i18n="driver_win_1">
              Установите VB‑CABLE.
            </div>
            <div data-i18n="driver_win_2">
              Выход системы → CABLE Input, вход агента → CABLE Output.
            </div>
            <a
              class="driver-link"
              href="https://vb-audio.com/Cable/"
              target="_blank"
              rel="noopener noreferrer"
            >
              VB‑CABLE — скачать
            </a>
          </div>
          <div class="driver-panel hidden" data-os="linux">
            <div data-i18n="driver_linux_1">
              Выберите “Monitor of …” для нужного sink в списке устройств.
            </div>
            <div data-i18n="driver_linux_2">
              Если нет monitor — включите loopback в PulseAudio/PipeWire.
            </div>
            <a
              class="driver-link"
              href="https://wiki.archlinux.org/title/PulseAudio/Examples#Loopback"
              target="_blank"
              rel="noopener noreferrer"
            >
              PulseAudio loopback
            </a>
            <a
              class="driver-link"
              href="https://docs.pipewire.org/page_pulse.html"
              target="_blank"
              rel="noopener noreferrer"
            >
              PipeWire (PulseAudio)
            </a>
          </div>
        </div>
      </section>

      <section class="card card-recording">
        <h2 data-i18n="recording_title">Запись</h2>
        <div class="field">
          <label data-i18n="capture_mode_label">Режим захвата</label>
          <div class="row">
            <label class="radio">
              <input type="radio" name="captureMode" value="system" checked />
              <span data-i18n="capture_mode_system">Системный звук</span>
            </label>
            <label class="radio">
              <input type="radio" name="captureMode" value="screen" />
              <span data-i18n="capture_mode_screen">Экран + звук</span>
            </label>
          </div>
          <div class="hint" data-i18n="capture_mode_hint">
            Для экрана со звуком включите “Share audio” в окне браузера.
          </div>
          <div class="hint" data-i18n="capture_mode_system_note">
            Важно: «Системный звук» пишет только выбранный виртуальный источник (не прямой микрофон).
          </div>
          <label class="checkbox include-mic">
            <input id="includeMic" type="checkbox" checked />
            <span data-i18n="include_mic_label">Добавлять микрофон в запись</span>
          </label>
          <div class="field mic-picker">
            <label for="micSelect" data-i18n="mic_input_label">Микрофон</label>
            <select id="micSelect">
              <option value="" data-i18n="mic_input_auto">Авто (рекомендуется)</option>
            </select>
          </div>
          <div class="field language-profile-picker">
            <label for="languageProfileSelect" data-i18n="language_profile_label">Язык интервью</label>
            <select id="languageProfileSelect">
              <option value="mixed" data-i18n="language_profile_mixed">Mixed (RU + EN)</option>
              <option value="ru" data-i18n="language_profile_ru">Русский</option>
              <option value="en" data-i18n="language_profile_en">English</option>
            </select>
            <div class="hint" data-i18n="language_profile_hint">
              Влияет на языковую подсказку STT и точность распознавания терминов.
            </div>
          </div>
          <div class="field quality-picker">
            <label data-i18n="quality_profile_label">Профиль качества</label>
            <div class="segmented">
              <button id="qualityFast" class="ghost" data-quality="fast" data-i18n="quality_fast">
                Fast
              </button>
              <button
                id="qualityBalanced"
                class="ghost active"
                data-quality="balanced"
                data-i18n="quality_balanced"
              >
                Balanced
              </button>
              <button
                id="qualityAccurate"
                class="ghost"
                data-quality="accurate"
                data-i18n="quality_accurate"
              >
                Accurate
              </button>
            </div>
            <div id="qualityHint" class="hint" data-i18n="quality_balanced_desc">
              Баланс точности и задержки.
            </div>
          </div>
          <div class="diag-block">
            <div class="row diag-header">
              <strong data-i18n="diag_title">Проверка перед стартом</strong>
              <button id="runDiagnostics" class="ghost" data-i18n="diag_run_btn">Проверить</button>
            </div>
            <div id="diagHint" class="hint" data-i18n="diag_hint_idle">
              Запустите диагностику перед записью.
            </div>
            <div class="diag-grid">
              <div id="diagAudio" class="diag-item muted" data-i18n="diag_audio_access">
                Доступ к аудио
              </div>
              <div id="diagSystem" class="diag-item muted" data-i18n="diag_system_level">
                Уровень system
              </div>
              <div id="diagMic" class="diag-item muted" data-i18n="diag_mic_level">
                Уровень mic
              </div>
              <div id="diagStt" class="diag-item muted" data-i18n="diag_stt_ready">
                STT готов
              </div>
              <div id="diagLlm" class="diag-item muted" data-i18n="diag_llm_ready">
                LLM доступен
              </div>
            </div>
          </div>
        </div>
        <div class="status">
          <span data-i18n="status_label">Статус:</span>
          <span id="statusText" class="status-pill idle" data-i18n="status_idle"
            >Ожидание</span
          >
        </div>
        <div id="statusHint" class="status-hint"></div>
        <div id="recognitionDiagnosis" class="status-hint muted" data-i18n="diag_reason_none">
          Диагноз: пока данных недостаточно.
        </div>
        <div class="countdown">
          <span data-i18n="countdown_label">Отсчёт:</span>
          <span id="countdownValue">—</span>
        </div>
        <div class="controls">
          <button id="startBtn" class="primary" data-i18n="start_btn">Старт</button>
          <button id="stopBtn" class="secondary" data-i18n="stop_btn" disabled>
            Стоп
          </button>
        </div>
        <div class="meter">
          <div class="meter-bar" id="levelBar"></div>
        </div>
        <div class="meter-detail">
          <div class="meter-row">
            <span id="systemLevelText" data-i18n="meter_system_label">System: —</span>
            <div class="meter meter-mini"><div class="meter-bar" id="systemLevelBar"></div></div>
          </div>
          <div class="meter-row">
            <span id="micLevelText" data-i18n="meter_mic_label">Mic: —</span>
            <div class="meter meter-mini"><div class="meter-bar" id="micLevelBar"></div></div>
          </div>
        </div>
        <div class="signal-row">
          <span id="signalText" data-i18n="signal_waiting">Сигнал: ожидание</span>
          <button id="checkSignal" class="ghost" data-i18n="signal_check">
            Проверить захват
          </button>
        </div>
        <div class="meta">
          <div>
            <span data-i18n="meeting_id_label">Meeting ID:</span>
            <span id="meetingIdText">—</span>
          </div>
          <div>
            <span data-i18n="chunks_label">Чанки:</span>
            <span id="chunkCount">0</span>
          </div>
        </div>
      </section>

      <section class="card card-upload">
        <h2 data-i18n="upload_title">Загрузка конференции</h2>
        <div class="field">
          <label data-i18n="upload_audio_label">Аудио файл</label>
          <div class="row">
            <input id="uploadAudio" type="file" accept="audio/*" />
            <button id="uploadAudioBtn" class="ghost" data-i18n="upload_audio_btn">
              Загрузить аудио
            </button>
          </div>
        </div>
        <div class="field">
          <label data-i18n="upload_video_label">Видео файл</label>
          <div class="row">
            <input id="uploadVideo" type="file" accept="video/*" disabled />
            <button id="uploadVideoBtn" class="ghost" disabled data-i18n="upload_video_btn">
              Видео (в разработке)
            </button>
          </div>
        </div>
        <div class="hint" data-i18n="upload_hint">
          Видео‑анализ появится после интеграции мультимодальной LLM.
        </div>
        <div class="hint" data-i18n="quick_record_title">Quick fallback запись</div>
        <div class="field">
          <label for="quickRecordUrl" data-i18n="quick_record_url_label">Ссылка встречи</label>
          <input
            id="quickRecordUrl"
            type="url"
            placeholder="https://..."
            data-i18n-placeholder="quick_record_url_placeholder"
          />
        </div>
        <div class="field">
          <label for="quickRecordDuration" data-i18n="quick_record_duration_label"
            >Длительность (сек)</label
          >
          <input id="quickRecordDuration" type="number" min="5" step="5" value="900" />
        </div>
        <div class="row">
          <label class="checkbox">
            <input id="quickRecordTranscribe" type="checkbox" />
            <span data-i18n="quick_record_transcribe_label">Сделать локальную транскрибацию</span>
          </label>
          <label class="checkbox">
            <input id="quickRecordUpload" type="checkbox" />
            <span data-i18n="quick_record_upload_label">Отправить запись в пайплайн агента</span>
          </label>
        </div>
        <div class="row">
          <button id="quickRecordStart" class="ghost" data-i18n="quick_record_start_btn">
            Quick старт
          </button>
          <button
            id="quickRecordStop"
            class="ghost"
            data-i18n="quick_record_stop_btn"
            disabled
          >
            Quick стоп
          </button>
          <span id="quickRecordState" class="pill muted" data-i18n="quick_record_state_idle"
            >Не запущено</span
          >
        </div>
        <div id="quickRecordHint" class="hint" data-i18n="quick_record_hint_ready">
          Fallback запись готова к запуску.
        </div>
      </section>

      <section class="card card-results">
        <h2 data-i18n="records_title">Результаты</h2>
        <div class="row">
          <button id="chooseFolder" class="ghost" data-i18n="choose_folder">
            Выбрать папку
          </button>
          <span id="folderStatus" class="pill muted" data-i18n="folder_not_selected">
            Папка не выбрана
          </span>
        </div>
        <div class="row">
          <select id="recordsSelect"></select>
          <button id="refreshRecords" class="ghost" data-i18n="records_refresh">
            Обновить
          </button>
          <div class="record-menu-wrap">
            <button id="recordMenuBtn" class="ghost menu-trigger" data-i18n="records_menu_btn">
              ...
            </button>
            <div id="recordMenu" class="record-menu hidden">
              <button id="renameRecordBtn" class="ghost" data-i18n="record_menu_rename">
                Переименовать запись
              </button>
              <button id="saveRecordMp3Btn" class="ghost" data-i18n="record_menu_save_mp3">
                Сохранить MP3
              </button>
            </div>
          </div>
        </div>
        <div class="results-source">
          <span class="label" data-i18n="results_source_label">Источник</span>
          <div class="segmented">
            <button id="resultsRaw" class="ghost active" data-source="raw">
              Raw
            </button>
            <button id="resultsClean" class="ghost" data-source="clean">
              Clean
            </button>
          </div>
        </div>
        <div class="file-row">
          <div class="file-info">
            <div class="file-title" data-i18n="file_transcript">Файл транскрипта</div>
            <div id="resultFileName" class="file-name">raw.txt</div>
          </div>
          <div class="file-actions">
            <button
              id="downloadArtifactBtn"
              class="ghost"
              data-action="download"
              data-i18n="file_action_download"
            >
              Скачать
            </button>
            <button
              id="reportArtifactBtn"
              class="ghost"
              data-action="report"
              data-i18n="file_action_report"
            >
              Отчёт
            </button>
            <button
              id="structuredArtifactBtn"
              class="ghost"
              data-action="structured"
              data-i18n="file_action_table"
            >
              Таблица
            </button>
            <button
              id="audioArtifactBtn"
              class="ghost"
              data-action="audio"
              data-i18n="file_action_mp3"
            >
              MP3
            </button>
          </div>
        </div>
        <div class="compare-block">
          <div class="row compare-header">
            <strong data-i18n="compare_title">Сравнение интервью</strong>
            <button id="refreshCompare" class="ghost" data-i18n="compare_refresh">
              Обновить
            </button>
          </div>
          <div id="compareHint" class="hint" data-i18n="compare_hint_idle">
            Сводка покажет сравнение кандидатов после генерации отчётов.
          </div>
          <div class="row compare-actions">
            <button id="downloadCompareCsv" class="ghost" data-i18n="compare_export_csv">
              Экспорт CSV
            </button>
            <button id="downloadCompareJson" class="ghost" data-i18n="compare_export_json">
              Экспорт JSON
            </button>
          </div>
          <div class="compare-table-wrap">
            <table id="compareTable" class="compare-table">
              <thead>
                <tr>
                  <th data-i18n="compare_col_candidate">Кандидат</th>
                  <th data-i18n="compare_col_vacancy">Вакансия</th>
                  <th data-i18n="compare_col_level">Уровень</th>
                  <th data-i18n="compare_col_score">Score</th>
                  <th data-i18n="compare_col_decision">Решение</th>
                  <th data-i18n="compare_col_quality">Качество</th>
                </tr>
              </thead>
              <tbody id="compareTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="card card-transcript">
        <h2 data-i18n="transcript_title">Транскрипт</h2>
        <div class="transcript-grid">
          <div class="transcript-box">
            <div class="transcript-header">
              <span data-i18n="raw_label">Raw</span>
              <span class="delay-note" data-i18n="raw_live">Live</span>
            </div>
            <textarea
              id="transcriptRaw"
              class="transcript-area"
              readonly
              placeholder="..."
              data-i18n-placeholder="transcript_placeholder_raw"
            ></textarea>
          </div>
          <div class="transcript-box">
            <div class="transcript-header">
              <span data-i18n="clean_label">Clean</span>
              <span class="delay-note" data-i18n="clean_delay">~3–4 сек</span>
            </div>
            <textarea
              id="transcriptClean"
              class="transcript-area"
              readonly
              placeholder="..."
              data-i18n-placeholder="transcript_placeholder_clean"
            ></textarea>
          </div>
        </div>
      </section>

    </main>

    <footer class="footer">
      <span data-i18n="footer_note">
        Данные остаются локально. Для записи требуется разрешение браузера.
      </span>
    </footer>

    <script src="/ui/app.js?v=20260213b"></script>
  </body>
</html>
