<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>9second_capture — Local Agent</title>
    <link rel="stylesheet" href="/ui/styles.css" />
  </head>
  <body>
    <div class="bg-layer"></div>
    <header class="header">
      <div class="brand">
        <div class="brand-mark">9s</div>
        <div class="brand-text">
          <div class="brand-title">9second_capture</div>
          <div class="brand-subtitle" data-i18n="subtitle">
            Локальный агент записи встреч
          </div>
        </div>
      </div>
      <div class="lang-toggle">
        <button class="lang-btn" data-lang="ru">RU</button>
        <button class="lang-btn" data-lang="en">EN</button>
      </div>
    </header>

    <main class="layout">
      <section class="card">
        <h2 data-i18n="connection_title">Подключение</h2>
        <div class="field">
          <label for="apiKey" data-i18n="api_key_label">API ключ (опционально)</label>
          <input
            id="apiKey"
            type="password"
            autocomplete="off"
            placeholder="X-API-Key"
            data-i18n-placeholder="api_key_placeholder"
          />
        </div>
        <div class="field">
          <label for="deviceSelect" data-i18n="device_label">Источник аудио</label>
          <div class="row">
            <select id="deviceSelect"></select>
            <button id="refreshDevices" class="ghost" data-i18n="refresh_devices">
              Обновить
            </button>
          </div>
        </div>
        <div class="hint" data-i18n="device_hint">
          Выберите виртуальный драйвер захвата системного звука.
        </div>
        <div class="row">
          <button id="checkDriver" class="ghost" data-i18n="driver_check">
            Проверить драйвер
          </button>
          <button id="driverHelpBtn" class="ghost" data-i18n="driver_help_btn">
            Инструкция
          </button>
          <span id="driverStatus" class="pill muted" data-i18n="driver_unknown">
            Драйвер не проверен
          </span>
        </div>
        <div id="driverHelp" class="driver-help hidden">
          <div class="driver-tabs">
            <button class="driver-tab active" data-os="mac" data-i18n="os_mac">
              macOS
            </button>
            <button class="driver-tab" data-os="win" data-i18n="os_windows">
              Windows
            </button>
            <button class="driver-tab" data-os="linux" data-i18n="os_linux">
              Linux
            </button>
          </div>
          <div class="driver-panel" data-os="mac">
            <div data-i18n="driver_mac_1">
              Установите BlackHole (2ch) и создайте Multi‑Output Device.
            </div>
            <div data-i18n="driver_mac_2">
              Выход системы → Multi‑Output, вход агента → BlackHole.
            </div>
          </div>
          <div class="driver-panel hidden" data-os="win">
            <div data-i18n="driver_win_1">
              Установите VB‑CABLE.
            </div>
            <div data-i18n="driver_win_2">
              Выход системы → CABLE Input, вход агента → CABLE Output.
            </div>
          </div>
          <div class="driver-panel hidden" data-os="linux">
            <div data-i18n="driver_linux_1">
              Выберите “Monitor of …” для нужного sink в списке устройств.
            </div>
            <div data-i18n="driver_linux_2">
              Если нет monitor — включите loopback в PulseAudio/PipeWire.
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <h2 data-i18n="recording_title">Запись</h2>
        <div class="field">
          <label data-i18n="capture_mode_label">Режим захвата</label>
          <div class="row">
            <label class="radio">
              <input type="radio" name="captureMode" value="system" checked />
              <span data-i18n="capture_mode_system">Системный звук</span>
            </label>
            <label class="radio">
              <input type="radio" name="captureMode" value="screen" />
              <span data-i18n="capture_mode_screen">Экран + звук</span>
            </label>
          </div>
        </div>
        <div class="status">
          <span data-i18n="status_label">Статус:</span>
          <span id="statusText" class="status-pill idle" data-i18n="status_idle"
            >Ожидание</span
          >
        </div>
        <div class="countdown">
          <span data-i18n="countdown_label">Отсчёт:</span>
          <span id="countdownValue">—</span>
        </div>
        <div class="controls">
          <button id="startBtn" class="primary" data-i18n="start_btn">Старт</button>
          <button id="stopBtn" class="secondary" data-i18n="stop_btn" disabled>
            Стоп
          </button>
        </div>
        <div class="meter">
          <div class="meter-bar" id="levelBar"></div>
        </div>
        <div class="signal-row">
          <span id="signalText" data-i18n="signal_waiting">Сигнал: ожидание</span>
          <button id="checkSignal" class="ghost" data-i18n="signal_check">
            Проверить захват
          </button>
        </div>
        <div class="meta">
          <div>
            <span data-i18n="meeting_id_label">Meeting ID:</span>
            <span id="meetingIdText">—</span>
          </div>
          <div>
            <span data-i18n="chunks_label">Чанки:</span>
            <span id="chunkCount">0</span>
          </div>
        </div>
      </section>

      <section class="card">
        <h2 data-i18n="upload_title">Загрузка конференции</h2>
        <div class="field">
          <label data-i18n="upload_audio_label">Аудио файл</label>
          <div class="row">
            <input id="uploadAudio" type="file" accept="audio/*" />
            <button id="uploadAudioBtn" class="ghost" data-i18n="upload_audio_btn">
              Загрузить аудио
            </button>
          </div>
        </div>
        <div class="field">
          <label data-i18n="upload_video_label">Видео файл</label>
          <div class="row">
            <input id="uploadVideo" type="file" accept="video/*" disabled />
            <button id="uploadVideoBtn" class="ghost" disabled data-i18n="upload_video_btn">
              Видео (в разработке)
            </button>
          </div>
        </div>
        <div class="hint" data-i18n="upload_hint">
          Видео‑анализ появится после интеграции мультимодальной LLM.
        </div>
      </section>

      <section class="card">
        <h2 data-i18n="transcript_title">Транскрипт</h2>
        <div class="row transcript-controls">
          <button id="viewRaw" class="ghost active" data-i18n="view_raw">
            Raw
          </button>
          <button id="viewEnhanced" class="ghost" data-i18n="view_enhanced">
            Clean
          </button>
        </div>
        <textarea
          id="transcriptArea"
          readonly
          placeholder="..."
          data-i18n-placeholder="transcript_placeholder"
        ></textarea>
      </section>

      <section class="card">
        <h2 data-i18n="records_title">Результаты</h2>
        <div class="row">
          <button id="chooseFolder" class="ghost" data-i18n="choose_folder">
            Выбрать папку
          </button>
          <span id="folderStatus" class="pill muted" data-i18n="folder_not_selected">
            Папка не выбрана
          </span>
        </div>
        <div class="row">
          <select id="recordsSelect"></select>
          <button id="refreshRecords" class="ghost" data-i18n="records_refresh">
            Обновить
          </button>
        </div>
        <div class="results-source">
          <span class="label" data-i18n="results_source_label">Источник</span>
          <div class="segmented">
            <button id="resultsRaw" class="ghost active" data-source="raw">
              Raw
            </button>
            <button id="resultsClean" class="ghost" data-source="clean">
              Clean
            </button>
          </div>
        </div>
        <div class="file-row">
          <div class="file-info">
            <div class="file-title" data-i18n="file_transcript">Файл транскрипта</div>
            <div id="resultFileName" class="file-name">raw.txt</div>
          </div>
          <div class="file-actions">
            <button
              id="downloadArtifactBtn"
              class="ghost"
              data-action="download"
              data-i18n="file_action_download"
            >
              Скачать
            </button>
            <button
              id="reportArtifactBtn"
              class="ghost"
              data-action="report"
              data-i18n="file_action_report"
            >
              Отчёт
            </button>
            <button
              id="structuredArtifactBtn"
              class="ghost"
              data-action="structured"
              data-i18n="file_action_table"
            >
              Таблица
            </button>
          </div>
        </div>
      </section>

      <section class="card">
        <h2 data-i18n="help_title">Как настроить звук</h2>
        <ul class="plain-list">
          <li data-i18n="help_item_1">
            Установите драйвер loopback (BlackHole / VB-Cable / PulseAudio).
          </li>
          <li data-i18n="help_item_2">
            macOS: BlackHole + Multi‑Output Device (колонки + BlackHole).
          </li>
          <li data-i18n="help_item_3">
            Windows: VB‑CABLE, вывод системы → CABLE Input, вход агента → CABLE Output.
          </li>
          <li data-i18n="help_item_4">
            Linux: выберите “Monitor of …” для нужного sink.
          </li>
          <li data-i18n="help_item_5">
            Нажмите «Проверить захват» и убедитесь, что уровень не нулевой.
          </li>
        </ul>
      </section>
    </main>

    <footer class="footer">
      <span data-i18n="footer_note">
        Данные остаются локально. Для записи требуется разрешение браузера.
      </span>
    </footer>

    <script src="/ui/app.js"></script>
  </body>
</html>
